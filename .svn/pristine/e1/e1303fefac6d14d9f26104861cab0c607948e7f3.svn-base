!function e(o,t,n){function r(i,s){if(!t[i]){if(!o[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[i]={exports:{}};o[i][0].call(l.exports,function(e){var t=o[i][1][e];return r(t?t:e)},l,l.exports,e,o,t,n)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e,o,t){var n=function(){};n.prototype.getUrlParam=function(){for(var e=location.search.slice(1),o={},t=e.split("&"),n=0;n<t.length;n++){var r=t[n].split("=");o[r[0]]||(o[r[0]]=r[1])}return o},n.prototype.localStorage={get:function(e){var o="";if("undefined"==typeof localStorage[e])return!1;try{return o=JSON.parse(localStorage[e]),"undefined"!=typeof o.value?o.value:o}catch(t){return localStorage[e]}},set:function(e,o){return"undefined"==typeof o?!1:(localStorage[e]=JSON.stringify({value:o}),!0)},del:function(e){"undefined"==typeof localStorage[e]?console.log("this item is not exit!"):delete localStorage[e]}},n.prototype.sessionStorage={get:function(e){var o="";if("undefined"==typeof sessionStorage[e])return"undefined";try{return o=JSON.parse(sessionStorage[e]),"undefined"!=typeof o.value?o.value:o}catch(t){return sessionStorage[e]}},set:function(e,o){return"undefined"==typeof o?!1:(sessionStorage[e]=JSON.stringify({value:o}),!0)},del:function(e){"undefined"==typeof sessionStorage[e]?console.log("this item is not exit!"):delete sessionStorage[e]}},n.prototype.config={serverBase:"/m/",knIndex:"/m/nav/kn/index",loginHref:"/m/nav/login",logoutHref:"/m/nav/logout"},"object"==typeof o&&"object"==typeof o.exports?o.exports=new n:window.GlobalKuNiao=n},{}],2:[function(e,o,t){var n=e("../common/global.js"),r={init:function(){this.getData()},getData:function(){$.ajax({type:"GET",url:n.config.serverBase+"/api/user/getUserInfo.json",success:function(e){if(r.updateBirth(),e&&"100"===e.code){var o=e.userInfo;if(o){var t=o.nickName;if(t||(t="未设置"),$(".nickname .nav1 a").text(t).attr("href","changename.html?name="+t),o.gender){var a="";a=1===o.gender?"男":2===o.gender?"女":"保密",$(".sex").html(a)}o.birthday&&$(".birth").val(o.birthday);var i=o.profile_photos;i||(i=1===o.gender?"../../images/home/photo_man.jpg":2===o.gender?"../../images/home/photo_woman.jpg":"../../images/home/photo_default.jpg"),$(".img-right").attr("src",i)}}else e&&"403"===e.code?window.location.href=n.config.loginHref:$.toast("error:"+e.msg)}})},uploadFile:function(){var e={module:"user",file:$(".headUpload").val()};$.ajax({type:"POST",data:e,url:n.config.serverBase+"api/common/upload.json",enctype:"multipart/form-data",success:function(e){e&&"100"===e.code?($(".img-right").attr("src",e.imgUrl),r.updateUserInfo(2,e.imgUrl)):(e=JSON.parse(e),e&&"403"===e.code?window.location.href=n.config.loginHref:$.toast("error:"+e.msg))}})},updateUserInfo:function(e,o){var t={type:e,value:o};console.log(t),$.ajax({type:"GET",url:n.config.serverBase+"api/user/updateUser.json",data:t,success:function(t){t&&"100"===t.code?(2===e&&$(".img-right").attr("src",o),r.getData(),$.toast("操作成功")):t&&"403"===t.code?window.location.href=n.config.loginHref:$.toast(t.msg)}})},updateBirth:function(){var e=new Date,o=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();t=t>9?t:"0"+t,a=a>9?a:"0"+a,$(".birth").calendar({onOpen:function(){$.ajax({type:"GET",url:n.config.serverBase+"/api/user/getUserInfo.json",success:function(e){e&&"100"===e.code||(e&&"403"===e.code?window.location.href=n.config.loginHref:$.toast("error:"+e.msg))}})},maxDate:o+"-"+t+"-"+a,onChange:function(e,o,t){r.updateUserInfo(4,t[0]),e.destroy()}})},logout:function(){window.location.href=n.config.logoutHref}};$(document).on("pageInit","#accountsetting",function(e,o,t){r.init(),$(".modal-overlay").click(function(e){e.stopPropagation()}),$(".sexdiv").click(function(){$.ajax({type:"GET",url:n.config.serverBase+"/api/user/getUserInfo.json",success:function(e){e&&"100"===e.code?$.modal({verticalButtons:!0,extraClass:"popup-sexdiv",buttons:[{text:"男",close:!0,onClick:function(){$(".sex").text("男"),r.updateUserInfo(3,1)}},{text:"女",close:!0,onClick:function(){$(".sex").text("女"),r.updateUserInfo(3,2)}}]}):e&&"403"===e.code?window.location.href=n.config.loginHref:$.toast("error:"+e.msg)}})}),$(".radioOption").click(function(e){e.cancelBubble=!0,$(".optionList").css("display","none"),$(".modal-overlay").removeClass("modal-overlay-visible");var o=$(this),t=o.text();$(".sex").text(t),r.updateUserInfo(3,o.val())}),$(".headUpload").click(function(e){$.ajax({type:"GET",url:n.config.serverBase+"/api/user/getUserInfo.json",success:function(e){e&&"100"===e.code||(e&&"403"===e.code?window.location.href=n.config.loginHref:$.toast("error:"+e.msg))}})}),$(".headUpload").change(function(e){function o(){if(!t.readyState||"complete"==t.readyState)try{var e=t.contentWindow.document;e=e.getElementsByTagName("pre")[0].innerText,e=JSON.parse(e),"905"==e.code&&$.toast(e.msg),e.imgUrl&&($(".img-right").attr("src",e.imgUrl),r.updateUserInfo(2,e.imgUrl))}catch(o){console.log(o)}}var t=$("iframe[name=ajaxUpload]").get(0);t.onload=t.onreadystatechange=o;var a=e.currentTarget.files[0],i=new RegExp("\\.(jpg|png|jpeg|gif)$","i"),s=1e6;a&&(i.test(a.name)?a.size<=s?($(".form").attr("action",n.config.serverBase+"/api/common/upload.json"),$(".form").submit()):$.toast("图片大小不可大于1M"):$.toast("只支持png、jpg、jpeg、gif格式的图片上传"))}),$(".exit-acount-li").click(function(){$.confirm("确定退出当前账户 ?",function(){r.logout()})}),$(".acount-safe-li").click(function(){$.router.load("accountsafe.html")})})},{"../common/global.js":1}]},{},[2]);