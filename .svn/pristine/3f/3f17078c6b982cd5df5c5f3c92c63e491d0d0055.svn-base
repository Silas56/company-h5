!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return o(n?n:t)},p,p.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){!function(t){function r(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function o(){this.raw=[],this.length=0}function i(){return"___"+C++}function s(t,e){var n=new Function;n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}function a(t){return I[t]}function c(t){return'"'+t.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function l(t){return t.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(t){return"\\"+t})}function p(t){var e=arguments;return t.replace(/\{([0-9]+)\}/g,function(t,n){return e[n-0+1]})}function u(t){return t=t.replace(/^\s*\*/,""),p('gv({0},["{1}"])',c(t),t.replace(/\[['"]?([^'"]+)['"]?\]/g,function(t,e){return"."+e}).split(".").join('","'))}function h(t,e,n,r,o,i){for(var s=n.length,a=t.split(e),c=0,l=[],p=0,u=a.length;u>p;p++){var h=a[p];if(p){var f=1;for(c++;;){var g=h.indexOf(n);if(0>g){l.push(c>1&&f?e:"",h);break}if(c=r?c-1:0,l.push(c>0&&f?e:"",h.slice(0,g),c>0?n:""),h=h.slice(g+s),f=0,0===c)break}0===c&&(o(l.join("")),i(h),l=[])}else h&&i(h)}c>0&&l.length>0&&(i(e),i(l.join("")))}function f(t,e,n){var r,o=[],i=e.options,s="",a="",l="",p="";return n&&(s="ts(",a=")",l=D,p=T,r=i.defaultFilter),h(t,i.variableOpen,i.variableClose,1,function(t){n&&t.indexOf("|")<0&&r&&(t+="|"+r);var i=t.indexOf("|"),c=(i>0?t.slice(0,i):t).replace(/^\s+/,"").replace(/\s+$/,""),h=i>0?t.slice(i+1):"",g=0===c.indexOf("*"),d=[g?"":s,u(c),g?"":a];if(h){h=f(h,e);for(var v=h.split("|"),y=0,m=v.length;m>y;y++){var $=v[y];/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test($)&&(d.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3&&d.push(",",RegExp.$3),d.push(")"))}}o.push(l,d.join(""),p)},function(t){o.push(l,n?c(t):t,p)}),o.join("")}function g(t,e){this.value=t,this.engine=e}function d(t,e){this.value=t,this.engine=e,this.children=[],this.cloneProps=[]}function v(t,e){var n=t.stack,r=e?n.find(function(t){return t instanceof e}):n.bottom();if(r){for(var o;(o=n.top())!==r;){if(!o.autoClose)throw new Error(o.type+" must be closed manually: "+o.value);o.autoClose(t)}r.close(t)}return r}function y(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.master=RegExp.$3,this.name=RegExp.$1,d.call(this,t,e),this.blocks={}}function m(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,d.call(this,t,e),this.cloneProps=["name"]}function $(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,d.call(this,t,e),this.cloneProps=["name","state","blocks","target"],this.blocks={}}function x(t,e){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.expr=RegExp.$2,d.call(this,t,e),this.cloneProps=["name","expr"]}function w(t,e){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,t,e),this.cloneProps=["name","args"]}function R(t,e){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,t,e),this.cloneProps=["name","args"]}function E(t,e){var n=new RegExp(p("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",l(e.options.variableOpen),l(e.options.variableClose)),"i");if(!n.test(t))throw new Error("Invalid "+this.type+" syntax: "+t);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,d.call(this,t,e),this.cloneProps=["list","item","index"]}function b(t,e){d.call(this,t,e)}function S(t,e){b.call(this,t,e)}function k(t,e){d.call(this,t,e)}function j(t,e){e.target=t;var n=e.engine,r=t.name;if(n.targets[r])switch(n.options.namingConflict){case"override":n.targets[r]=t,e.targets.push(r);case"ignore":break;default:throw new Error("[ETPL_TARGET_EXISTS]"+r)}else n.targets[r]=t,e.targets.push(r)}function O(t,e){N[t]=e,e.prototype.type=t}function P(t){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]*)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(t),this.targets={},this.filters=r({},_)}function B(t,e){function n(){var t;if(p.length>0&&(t=p.join(""))){var n=new g(t,e);n.beforeAdd(l),c.top().addChild(n),p=[],e.options.strip&&l.current instanceof d&&(n.value=t.replace(/^[\x20\t\r]*\n/,"")),l.current=n}}var r,i=e.options.commandOpen,s=e.options.commandClose,a=e.options.commandSyntax,c=new o,l={engine:e,targets:[],stack:c,target:null},p=[];return h(t,i,s,0,function(t){var o,c=a.exec(t);if(c&&(o=c[2]||"target")&&(r=N[o.toLowerCase()])&&"function"==typeof r){n();var u=l.current;e.options.strip&&u instanceof g&&(u.value=u.value.replace(/\r?\n[\x20\t]*$/,"\n")),c[1]?u=v(l,r):(u=new r(c[3],e),"function"==typeof u.beforeOpen&&u.beforeOpen(l),u.open(l)),l.current=u}else/^\s*\/\//.test(t)||p.push(i,t,s);r=null},function(t){p.push(t)}),n(),v(l),l.targets}o.prototype={push:function(t){this.raw[this.length++]=t},pop:function(){if(this.length>0){var t=this.raw[--this.length];return this.raw.length=this.length,t}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(t){for(var e=this.length;e--;){var n=this.raw[e];if(t(n))return n}}};var C=178245,I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_={html:function(t){return t.replace(/[&<>"']/g,a)},url:encodeURIComponent,raw:function(t){return t}},A='var r="";',D="r+=",T=";",H="return r;";"undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8&&(A="var r=[],ri=0;",D="r[ri++]=",H='return r.join("");'),g.prototype={getRendererBody:function(){var t=this.value,e=this.engine.options;return!t||e.strip&&/^\s*$/.test(t)?"":f(t,this.engine,1)},clone:function(){return this}},d.prototype={addChild:function(t){this.children.push(t)},open:function(t){var e=t.stack.top();e&&e.addChild(this),t.stack.push(this)},close:function(t){t.stack.top()===this&&t.stack.pop()},getRendererBody:function(){for(var t=[],e=this.children,n=0;n<e.length;n++)t.push(e[n].getRendererBody());return t.join("")},clone:function(){for(var t=this.constructor,e=new t(this.value,this.engine),n=0,r=this.children.length;r>n;n++)e.addChild(this.children[n].clone());for(var n=0,r=this.cloneProps.length;r>n;n++){var o=this.cloneProps[n];e[o]=this[o]}return e}};var z='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';s(y,d),s(m,d),s($,d),s(x,d),s(w,d),s(R,d),s(E,d),s(b,d),s(S,b),s(k,b);var L={READING:1,READED:2,APPLIED:3,READY:4};$.prototype.applyMaster=y.prototype.applyMaster=function(t){function e(t){var r=t.children;if(r instanceof Array)for(var o=0,i=r.length;i>o;o++){var s=r[o];s instanceof m&&n[s.name]&&(s=r[o]=n[s.name]),e(s)}}if(this.state>=L.APPLIED)return 1;var n=this.blocks,r=this.engine.targets[t];if(r){if(r.applyMaster(r.master))return this.children=r.clone().children,e(this),this.state=L.APPLIED,1}else if("error"===this.engine.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+t+", when extended by "+(this.target?this.target.name:this.name))},y.prototype.isReady=function(){function t(o){for(var i=0,s=o.children.length;s>i;i++){var a=o.children[i];if(a instanceof $){var c=e.targets[a.name];if(!c&&"error"===e.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+a.name+", when imported by "+n);r=r&&c&&c.isReady(e)}else a instanceof d&&t(a)}}if(this.state>=L.READY)return 1;var e=this.engine,n=this.name,r=1;return this.applyMaster(this.master)?(t(this),r&&(this.state=L.READY),r):void 0},y.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var t=new Function("data","engine",[z,A,this.getRendererBody(),H].join("\n")),e=this.engine;return this.renderer=function(n){return t(n,e)},this.renderer}return null},y.prototype.open=function(t){v(t),d.prototype.open.call(this,t),this.state=L.READING,j(this,t)},x.prototype.open=R.prototype.open=function(t){t.stack.top().addChild(this)},m.prototype.open=function(t){d.prototype.open.call(this,t),t.stack.find(function(t){return t.blocks}).blocks[this.name]=this},S.prototype.open=function(t){var e=new k;e.open(t);var n=v(t,b);n.addChild(this),t.stack.push(this)},k.prototype.open=function(t){var e=v(t,b);e.addChild(this),t.stack.push(this)},$.prototype.open=function(t){this.parent=t.stack.top(),this.target=t.target,d.prototype.open.call(this,t),this.state=L.READING},R.prototype.close=x.prototype.close=function(){},$.prototype.close=function(t){d.prototype.close.call(this,t),this.state=L.READED},y.prototype.close=function(t){d.prototype.close.call(this,t),this.state=this.master?L.READED:L.APPLIED,t.target=null},$.prototype.autoClose=function(t){var e=this.parent.children;e.push.apply(e,this.children),this.children.length=0;for(var n in this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(t)},R.prototype.beforeOpen=$.prototype.beforeOpen=x.prototype.beforeOpen=E.prototype.beforeOpen=w.prototype.beforeOpen=m.prototype.beforeOpen=b.prototype.beforeOpen=g.prototype.beforeAdd=function(t){if(!t.stack.bottom()){var e=new y(i(),t.engine);e.open(t)}},$.prototype.getRendererBody=function(){return this.applyMaster(this.name),d.prototype.getRendererBody.call(this)},R.prototype.getRendererBody=function(){return p("{0}engine.render({2},{{3}}){1}",D,T,c(this.name),f(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(t,e,n){return(e||"")+c(n)+":"}))},x.prototype.getRendererBody=function(){return this.expr?p("v[{0}]={1};",c(this.name),f(this.expr,this.engine)):""},b.prototype.getRendererBody=function(){return p("if({0}){{1}}",f(this.value,this.engine),d.prototype.getRendererBody.call(this))},k.prototype.getRendererBody=function(){return p("}else{{0}",d.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){return p('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',i(),f(this.list,this.engine),c(this.index||i()),c(this.item),i(),i(),d.prototype.getRendererBody.call(this))},w.prototype.getRendererBody=function(){var t=this.args;return p("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",A,H,D,T,d.prototype.getRendererBody.call(this),c(this.name),t?","+f(t,this.engine):"")};var N={};O("target",y),O("block",m),O("import",$),O("use",R),O("var",x),O("for",E),O("if",b),O("elif",S),O("else",k),O("filter",w),P.prototype.config=function(t){r(this.options,t)},P.prototype.compile=P.prototype.parse=function(t){if(t){var e=B(t,this);if(e.length)return this.targets[e[0]].getRenderer()}return new Function('return ""')},P.prototype.getRenderer=function(t){var e=this.targets[t];return e?e.getRenderer():void 0},P.prototype.render=function(t,e){var n=this.getRenderer(t);return n?n(e):""},P.prototype.addFilter=function(t,e){"function"==typeof e&&(this.filters[t]=e)};var V=new P;V.Engine=P,V.version="3.1.0","object"==typeof n&&"object"==typeof e?n=e.exports=V:"function"==typeof define&&define.amd?define(V):t.etpl=V}(this)},{}],2:[function(t,e,n){var r=function(){};r.prototype.getUrlParam=function(){for(var t=location.search.slice(1),e={},n=t.split("&"),r=0;r<n.length;r++){var o=n[r].split("=");e[o[0]]||(e[o[0]]=o[1])}return e},r.prototype.localStorage={get:function(t){var e="";if("undefined"==typeof localStorage[t])return!1;try{return e=JSON.parse(localStorage[t]),"undefined"!=typeof e.value?e.value:e}catch(n){return localStorage[t]}},set:function(t,e){return"undefined"==typeof e?!1:(localStorage[t]=JSON.stringify({value:e}),!0)},del:function(t){"undefined"==typeof localStorage[t]?console.log("this item is not exit!"):delete localStorage[t]}},r.prototype.sessionStorage={get:function(t){var e="";if("undefined"==typeof sessionStorage[t])return"undefined";try{return e=JSON.parse(sessionStorage[t]),"undefined"!=typeof e.value?e.value:e}catch(n){return sessionStorage[t]}},set:function(t,e){return"undefined"==typeof e?!1:(sessionStorage[t]=JSON.stringify({value:e}),!0)},del:function(t){"undefined"==typeof sessionStorage[t]?console.log("this item is not exit!"):delete sessionStorage[t]}},r.prototype.config={serverBase:"/m/",knIndex:"/m/nav/kn/index",loginHref:"/m/nav/login",logoutHref:"/m/nav/logout"},"object"==typeof e&&"object"==typeof e.exports?e.exports=new r:window.GlobalKuNiao=r},{}],3:[function(t,e,n){var r=t("../common/global.js"),o=t("../common/etpl.js"),i=t("./tpl/suggest.html"),s={init:function(){var t=r.getUrlParam();t&&"shop"===t.type&&($(".category").val(1),$(".cateValue").attr("placeholder","请输入店铺名称"));var e=r.config.serverBase+"api/search/productHotSearch.json";this.getHotSearch(e),this.getHistory(),this.initButtons()},initButtons:function(){$(".category").change(function(){$(".cateValue").val("");var t=this.options[this.selectedIndex].value,e="";"0"===t?(e="productSuggest.json",$(".cateValue").attr("placeholder","请输入产品名称")):(e="storeSuggest.json",$(".cateValue").attr("placeholder","请输入店铺名称")),e=r.config.serverBase+"api/search/"+e,s.getHotSearch(e);var n="0"===t?"productHotSearch.json":"storeHotSearch.json";n=r.config.serverBase+"api/search/"+n,s.getHistory(n)}),$(".cateValue").focus(function(){$(".relative").attr("display","block")}),$(".cateValue").blur(function(){$(".relative").attr("display","none")}),$(".cateValue").change(function(){var t=$(".category"),e=t.val(),n="0"===e?"productSuggest.json":"storeSuggest.json";n=r.config.serverBase+"api/search/"+n;var o=$(this).val();s.getRelative($(".relative"),n,o,e)}),$(".clearHis a").click(function(){s.clearHisSearch(),window.location.reload()}),$(".content-block a").click(function(){var t=$(this).attr("value");s.search(t)}),$(".btnsearch").click(function(){var t=$(".cateValue").val();s.search(t)}),$("#search_page .bar-nav a").click(function(){window.location.href=r.config.serverBase+"/nav/kn/index"}),$(".clearCateValue").click(function(){$(".cateValue").val(""),window.location.href="search.html?type=shop"})},getHotSearch:function(t){$.ajax({url:t,type:"GET",success:function(t){if(t&&"100"==t.code){var e=t.resultList;if(e&&e.length>0){var n=$(".category"),r=n.val(),o="0"===r?"searchProduct.html":"searchShop.html",i="";$.each(e,function(t,e){var n=encodeURIComponent(this);i=i+"<a href='"+o+"?catevalue="+n+"' class='button' value='"+this+"'external>"+this+"</a>"}),$(".content-block").html(i)}}}})},getHistory:function(){var t=r.localStorage.get("his"),e="";if(t&&"undefined"!==t){var n=$(".category").val(),o=0;$.each(t,function(t,r){return r&&r.type===n&&10>o&&(e+='<li class="item-content" type='+r.type+'><div class="item-inner"><div class="item-title">'+decodeURIComponent(r.text)+"</div></div></li>",++o),10===o?!1:void 0})}$(".history ul").html(e),$("li.item-content").click(function(){var t=$(this).find(".item-title").text(),e=$(this).attr("type");s.search(t,e)})},getRelative:function(t,e,n,r){var s={};r&&""!==r.trim()&&(s={keyWord:n,arg1:r}),$.ajax({url:e,type:"GET",data:s,success:function(e){if(e&&"100"==e.code){var n=e.resultList;if(n&&n.length>0){var r=o.compile(i),s={suggests:n},a=r(s);t.html(a)}}}})},clearHisSearch:function(){r.localStorage.del("his")},search:function(t,e){var n=e?e:$(".category").val(),o="0"===n?"searchProduct.html":"searchShop.html";if(0===t.trim().length)return void(window.location.href=o);t=encodeURIComponent(t);var i=r.localStorage.get("his"),s=[],a={};if(a.type=n,a.text=t,i&&"undefined"!==i){var c=!1;$.each(i,function(e,r){return r&&r.type===n&&r.text===t?(c=!0,!1):void 0}),c||i.push(a)}else s.push(a),i=s;r.localStorage.set("his",i),window.location.href=o+"?catevalue="+t}};$(document).on("pageInit","#search_page",function(t,e,n){s.init()})},{"../common/etpl.js":1,"../common/global.js":2,"./tpl/suggest.html":4}],4:[function(t,e,n){e.exports='<!-- for: ${suggests} as ${suggest} --><li class="item-content">  <div class="item-inner">    <div class="item-title">${suggest}</div>  </div></li><!-- /for -->'},{}]},{},[3]);